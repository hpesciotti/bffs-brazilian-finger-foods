{% extends "base.html" %}
{% load static %}
{% load custom_filters %}

{% block page_header %}
<div class="container header-container">
    <div class="row">
        <div class="col">

        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="row justify-content-center my-sm-5 my-3 my-lg-4">
    <div class="col-12">
        <h3 class="text-center">Admin Panel</h3>
    </div>
    <div class="col-12 col-lg-5 px-2">
        <div class="accordion" id="InfoAccordion">
            <div class="accordion" id="accordionInfo">
                <div class="accordion-item">
                    <h5 class="accordion-header" id="headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                            Manage Your Store
                        </button>
                    </h5>
                    <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne"
                        data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                            <p class="text-grey fs-7">
                                As a store owner, you can easily manage your product batches.
                                Existing batches are displayed in the table below, where you can view details such as
                                batch numbers, expiry dates, quantities, and prices.
                                Please note that a batch with an expired expiry date will be automatically removed from
                                the system.
                            </p>
                            <p class="text-grey fs-10">
                                <span class="text-muted">(This feature will not be implemented in this educational
                                    version of the project,
                                    but should be available in the real-world version for future use, allowing the
                                    system to erase expired products from the database.)</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12 col-lg-3">
        <div class="text-center">
            <a href="{% url 'add_batch' %}" class="btn btn-dk-orange">View More</a>
        </div>
    </div>
    <!-- Search Form -->
    <div class="col-12 col-lg-8 my-4 py-1 py-lg-0">
        <form method="GET">
            <div class="input-group w-100">
                <input class="form-control border border-dk-orange rounded-0" type="text" value="{{ search_query }}"
                    placeholder="Search Batch">
                <div class="input-group-append">
                    <button class="form-control btn btn-dk-orange border border-dk-orange rounded-0" type="submit">
                        <span class="icon">
                            <i class="fas fa-search" aria-hidden="true"></i>
                        </span>
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Batch Table -->
    <div class="col-12 col-lg-10">
        <div class="table-responsive" style="max-height: 600px; overflow-y: scroll;">
            <table class="table">
                <thead style="position: sticky; top: 0; background-color: #e55125; z-index: 1;">
                    <tr class="text-white fs-6">
                        <th><a
                                href="?sort_by=product__short_widget_name&sort_order={% if sort_by == 'product__name' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">Product</a>
                        </th>
                        <th><a
                                href="?sort_by=batch_number&sort_order={% if sort_by == 'batch_number' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">Batch
                                Number</a></th>
                        <th><a
                                href="?sort_by=expiry_date&sort_order={% if sort_by == 'expiry_date' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">Expiry
                                Date</a></th>
                        <th><a
                                href="?sort_by=quantity&sort_order={% if sort_by == 'quantity' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">Quantity</a>
                        </th>
                        <th><a
                                href="?sort_by=offer&sort_order={% if sort_by == 'offer' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">Offer</a>
                        </th>
                        <th><a
                                href="?sort_by=discount_percentage&sort_order={% if sort_by == 'discount_percentage' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">Discount
                                Percentage</a></th>
                        <th><a
                                href="?sort_by=sale_price&sort_order={% if sort_by == 'sale_price' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">Sale
                                Price</a></th>
                    </tr>
                </thead>
                <tbody>
                    {% for batch in batches %}
                    <tr>
                        <td>{{ batch.product.short_widget_name }}</td>
                        <td>{{ batch.batch_number }}</td>
                        <td>{{ batch.expiry_date }}</td>
                        <td>{{ batch.quantity }}</td>
                        <td>{{ batch.get_offer_display }}</td>
                        <td>{{ batch.discount_percentage }}</td>
                        <td>{{ batch.sale_price }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8">No batches found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}


{% block postloadjs %}
{{ block.super }}
{% endblock %}